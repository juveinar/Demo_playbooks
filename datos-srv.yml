---
- name: Recopilar informacion detallada del servidor y version de Python
  hosts: all
  become: no
  gather_facts: true

  tasks:
    # Tarea 1: Mostrar informacion basica del sistema
    - name: Mostrar hechos del sistema operativo
      ansible.builtin.debug:
        msg: |
          Nombre del OS: {{ ansible_facts['distribution'] }} {{ ansible_facts['distribution_version'] }}
          Kernel: {{ ansible_facts['kernel'] }}
          Familia del OS: {{ ansible_facts['os_family'] }}
      tags:
        - info
    
    # Tarea 2: Obtener la version de Python del sistema
    - name: Obtener la version de Python
      ansible.builtin.command: python3 --version
      register: python_version
      changed_when: false
      ignore_errors: true
      tags:
        - python
        - info
    
    # Tarea 3: Mostrar la version de Python si se encontro
    - name: Mostrar version de Python si esta instalada
      ansible.builtin.debug:
        msg: "Version de Python: {{ python_version.stdout }}"
      when: python_version.rc == 0
      tags:
        - python
        - info
        
    # Tarea 4: Obtener el estado de SELinux
    - name: Obtener el estado de SELinux
      ansible.builtin.command: sestatus
      register: selinux_status
      changed_when: false
      ignore_errors: true
      tags:
        - selinux
        - info

    # Tarea 5: Mostrar el estado de SELinux
    - name: Mostrar el estado de SELinux
      ansible.builtin.debug:
        msg: "Estado de SELinux:\n{{ selinux_status.stdout }}"
      when: selinux_status.rc == 0
      tags:
        - selinux
        - info
   
    # Tarea 6: Mostrar direcciones IP
    - name: Mostrar las direcciones IPv4 del servidor
      ansible.builtin.debug:
        msg: "Direcciones IPv4: {{ ansible_facts['all_ipv4_addresses'] | join(', ') }}"
      tags:
        - network
        - info
        
    # Tarea 7: Obtener la informacion de los discos con el comando lsblk
    - name: Obtener informacion de los discos con lsblk
      ansible.builtin.shell: lsblk -J
      register: disk_info_shell
      changed_when: false
      tags:
        - disk
        - info

    # Tarea 8: Mostrar la informacion de los discos
    - name: Mostrar informacion de los discos
      ansible.builtin.debug:
        msg: "{{ disk_info_shell.stdout | from_json }}"
      tags:
        - disk
        - info
